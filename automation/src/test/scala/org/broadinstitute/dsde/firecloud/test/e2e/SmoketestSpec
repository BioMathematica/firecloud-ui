package org.broadinstitute.dsde.firecloud.test.e2e

import org.broadinstitute.dsde.firecloud.config.SmoketestConfig
import org.broadinstitute.dsde.firecloud.fixture.WorkspaceFixtures
import org.broadinstitute.dsde.firecloud.page.workspaces.WorkspaceSummaryPage
import org.broadinstitute.dsde.firecloud.test.WebBrowserSpec
import org.scalatest._

class SmoketestSpec extends FreeSpec with WebBrowserSpec with WorkspaceFixtures with Matchers {
  // todo: add with cleanup; we want to cleanup workspace and any objects created by test

  val billingProject: String = SmoketestConfig.Projects.default

  "Smoketest 1" in withWebDriver { implicit driver =>

    // login
    var listPageAsUser = signIn(SmoketestConfig.Users.testuser)
    assert(listPageAsUser.readUserEmail().equals(SmoketestConfig.Users.testuser.email))

    // create workspace
    val workspaceName = "Smoketests_create_" + randomUuid
    val detailPage = listPageAsUser.createWorkspace(billingProject, workspaceName).awaitLoaded()

    detailPage.ui.readWorkspaceName shouldEqual workspaceName
    listPageAsUser.open
    listPageAsUser.filter(workspaceName)
    listPageAsUser.ui.hasWorkspace(billingProject, workspaceName) shouldBe true

    // go to library

    // find library dataset

    // use dataset to create new workspace

    // import known method config

    // run method config on data in workspace

    // turn off call caching

    // wait for job to complete

    // delete workspace
    detailPage.deleteWorkspace()

    // logout



  }

}